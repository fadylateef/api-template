<html>
<head>
    <title>CPanel</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
</head>
<body>
    <table class="table table-bordered table-striped">
  <thead>
    <tr>
      <th scope="col" style="width: 50px">ID</th>
      <th scope="col">Series Name</th>
      <th scope="col" style="width: 50px">Last Episode</th>
      <th scope="col">Episode Link</th>
      <th scope="col" style="width: 150px">Add Epsiode</th>
      <th scope="col" style="width: 500px">Status</th>
    </tr>
  </thead>
  <tbody>
        #for(result in results) {
        <tr>
      <th scope="row">#(result.id)</th>
      <td>#(result.name)</td>
      <td>#(result.last_episode)</td>
      <td>
        <input type="text" class="form-control" placeholder="Put your video link here.">
      </td>
        <td>
            <button type="button" class="btn btn-primary" onclick="download(#(result.id))">Download</button>
        </td>
        <td></td>
    </tr>
    }
  </tbody>
</table>
<script>
            var rows = document.getElementsByTagName("table")[0].rows;
            ws = new WebSocket("wss://drmdn.app/echo");
            let row_id = event
            ws.onmessage = function (event) {
                var response = event.split(',')
                var row = rows[response[0]];
                var cell = row.cells[row.cells.length - 1];
                cell.innerHTML = response[1];
            }
    function download(event) {
            var row = rows[event];
            let series_id = row.cells[0].innerHTML;
            let episode_id = row.cells[2].innerHTML;
            let episode_link = row.cells[3].firstElementChild.value;
            let btn = row.cells[4].firstElementChild;
            btn.setAttribute("disabled","");
            btn.innerHTML = "Loading ..";
            ws.send(`${series_id},${episode_id},${episode_link}`);
    }
</script>
</body>
</html>
